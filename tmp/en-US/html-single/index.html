<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Best Practices Guide</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.8" /><meta name="package" content="CloudStack-Best_Practices_Guide-2.2.13-en-US-1-1" /><meta name="description" content="" /></head><body class="draft "><p id="title"><a class="left" href="http://cloudstack.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://docs.cloud.com"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><div xml:lang="en-US" class="book" id="id357583" lang="en-US"><div class="titlepage"><div><div class="producttitle"><span class="productname">CloudStack</span> <span class="productnumber">2.2.13</span></div><div><h1 id="id357583" class="title">Best Practices Guide</h1></div><div><h2 class="subtitle">A guide capturing the answers to the questions that many system administrators have before deploying CloudStack.</h2></div><p class="edition">Edition 1</p><div><h3 class="corpauthor">
		<span class="inlinemediaobject"><object data="Common_Content/images/title_logo.svg" type="image/svg+xml"> </object></span>

	</h3></div><div><div xml:lang="en-US" class="authorgroup" lang="en-US"><div class="author"><h3 class="author"><span class="firstname">Eric</span> <span class="surname">Christensen</span></h3><div class="affiliation"><span class="orgname">Citrix</span> <span class="orgdiv">CloudStack</span></div><code class="email"><a class="email" href="mailto:eric.christensen@citrix.com">eric.christensen@citrix.com</a></code></div></div></div><hr /><div><div id="id588606" class="legalnotice"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"></span>© 2011-2012 Citrix and Contributors.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Cloud.com under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. The original authors of this document, and Cloud.com, designate the Cloud.com as the "Attribution Party" for purposes of CC-BY-SA. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Cloud.com, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Cloud.com, CloudStack, the Cloud.com logo, Cloudbridge, Hypervisor Attached Storage, HAS, Hypervisor Aware Network, HAN, and VMSync are trademarks or registered trademarks of Cloud.com.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div><div><div class="abstract"><h6>Abstract</h6><div class="para">

		</div></div></div></div><hr /></div><div class="toc"><dl><dt><span class="preface"><a href="#pref-Best_Practices_Guide-Preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#id525770">1. Document Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#id545687">1.1. Typographic Conventions</a></span></dt><dt><span class="section"><a href="#id619672">1.2. Pull-quote Conventions</a></span></dt><dt><span class="section"><a href="#id636223">1.3. Notes and Warnings</a></span></dt></dl></dd><dt><span class="section"><a href="#id619704">2. We Need Feedback!</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-Building_your_cloud">1. Building Your Cloud</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Building_your_cloud-Staging_Area">1.1. Staging Area</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Building_your_cloud-Time">1.2. Taking adequate time for planning.</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-Clusters">2. Clusters</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Clusters-Limits">2.1. Recommended Limits</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Clusters-Switch_Density">2.2. Network Switch Density</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-Hosts">3. Hypervisor Hosts</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Hosts-Identical_Setup">3.1. Setting up your hosts</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Hosts-Software">3.2. Hypervisor Software</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Hosts-Capacity">3.3. Host Capacity and Overprovisioning</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-KVM">4. KVM</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-KVM-Installation">4.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-KVM-Installation-Prerequisites">4.1.1. Prerequisites and Constraints</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-XenServer">5. XenServer</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Hardware">5.1. Hardware</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Limits">5.2. VM Limits</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Reusing_Servers">5.3. Reusing Servers</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Networking">5.4. Networking</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Networking-Bonding">5.4.1. NIC Bonding</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-vSphere">6. VMWare vSphere</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Installation">6.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">6.1.1. Prerequisites and Constraints</a></span></dt></dl></dd><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Limits">6.2. VM Limits</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Networking">6.3. Networking</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Networking-Increasing_Ports">6.3.1. Increasing Ports</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-OVM">7. Oracle VM (OVM)</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-OVM-Installation">7.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-OVM-Installation-Prerequisites">7.1.1. Prerequisites and Constraints</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-Networking">8. Networking</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-IP_Address_Planning">8.1. IP Address Planning</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-NIC_Bonding">8.2. NIC Bonding</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-vSphere">8.3. Networking in vSphere</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-KVM_and_XenServer">8.4. Networking in KVM and XenServer</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-Database">9. MySQL Database</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Database-Security">9.1. Security</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Database-Replication">9.2. Replication</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-Primary_Storage">10. Primary Storage</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Primary_Storage-Per_Cluster">10.1. Primary Storage per Cluster</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Primary_Storage-Utilizing_RAID">10.2. Utilizing RAID</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Primary_Storage-Limiting_NFS_Export">10.3. Limiting NFS Export</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-Best_Practices_Guide-Templates">11. Templates</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Templates-Large_Templates">11.1. Large Templates</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Templates-XenServer">11.2. Templates in XenServer</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Templates-vSphere">11.3. Templates in vSphere</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appe-Best_Practices_Guide-Revision_History">A. Revision History</a></span></dt><dt><span class="index"><a href="#id367157">Index</a></span></dt></dl></div><div xml:lang="en-US" class="preface" id="pref-Best_Practices_Guide-Preface" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><div xml:lang="en-US" class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="id525770">1. Document Conventions</h2></div></div></div><div class="para">
		This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.
	</div><div class="para">
		In PDF and paper editions, this manual uses typefaces drawn from the <a href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set. The Liberation Fonts set is also used in HTML editions if the set is installed on your system. If not, alternative but equivalent typefaces are displayed. Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id545687">1.1. Typographic Conventions</h3></div></div></div><div class="para">
			Four typographic conventions are used to call attention to specific words and phrases. These conventions, and the circumstances they apply to, are as follows.
		</div><div class="para">
			<code class="literal">Mono-spaced Bold</code>
		</div><div class="para">
			Used to highlight system input, including shell commands, file names and paths. Also used to highlight keycaps and key combinations. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				To see the contents of the file <code class="filename">my_next_bestselling_novel</code> in your current working directory, enter the <code class="command">cat my_next_bestselling_novel</code> command at the shell prompt and press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</div></blockquote></div><div class="para">
			The above includes a file name, a shell command and a keycap, all presented in mono-spaced bold and all distinguishable thanks to context.
		</div><div class="para">
			Key combinations can be distinguished from keycaps by the hyphen connecting each part of a key combination. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</div><div class="para">
				Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span> to switch to the first virtual terminal. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> to return to your X-Windows session.
			</div></blockquote></div><div class="para">
			The first paragraph highlights the particular keycap to press. The second highlights two key combinations (each a set of three keycaps with each set pressed simultaneously).
		</div><div class="para">
			If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code class="literal">mono-spaced bold</code>. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				File-related classes include <code class="classname">filesystem</code> for file systems, <code class="classname">file</code> for files, and <code class="classname">dir</code> for directories. Each class has its own associated set of permissions.
			</div></blockquote></div><div class="para">
			<span class="application"><strong>Proportional Bold</strong></span>
		</div><div class="para">
			This denotes words or phrases encountered on a system, including application names; dialog box text; labeled buttons; check-box and radio button labels; menu titles and sub-menu titles. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Choose <span class="guimenu"><strong>System</strong></span> → <span class="guisubmenu"><strong>Preferences</strong></span> → <span class="guimenuitem"><strong>Mouse</strong></span> from the main menu bar to launch <span class="application"><strong>Mouse Preferences</strong></span>. In the <span class="guilabel"><strong>Buttons</strong></span> tab, click the <span class="guilabel"><strong>Left-handed mouse</strong></span> check box and click <span class="guibutton"><strong>Close</strong></span> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).
			</div><div class="para">
				To insert a special character into a <span class="application"><strong>gedit</strong></span> file, choose <span class="guimenu"><strong>Applications</strong></span> → <span class="guisubmenu"><strong>Accessories</strong></span> → <span class="guimenuitem"><strong>Character Map</strong></span> from the main menu bar. Next, choose <span class="guimenu"><strong>Search</strong></span> → <span class="guimenuitem"><strong>Find…</strong></span> from the <span class="application"><strong>Character Map</strong></span> menu bar, type the name of the character in the <span class="guilabel"><strong>Search</strong></span> field and click <span class="guibutton"><strong>Next</strong></span>. The character you sought will be highlighted in the <span class="guilabel"><strong>Character Table</strong></span>. Double-click this highlighted character to place it in the <span class="guilabel"><strong>Text to copy</strong></span> field and then click the <span class="guibutton"><strong>Copy</strong></span> button. Now switch back to your document and choose <span class="guimenu"><strong>Edit</strong></span> → <span class="guimenuitem"><strong>Paste</strong></span> from the <span class="application"><strong>gedit</strong></span> menu bar.
			</div></blockquote></div><div class="para">
			The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in proportional bold and all distinguishable by context.
		</div><div class="para">
			<code class="command"><em class="replaceable"><code>Mono-spaced Bold Italic</code></em></code> or <span class="application"><strong><em class="replaceable"><code>Proportional Bold Italic</code></em></strong></span>
		</div><div class="para">
			Whether mono-spaced bold or proportional bold, the addition of italics indicates replaceable or variable text. Italics denotes text you do not input literally or displayed text that changes depending on circumstance. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				To connect to a remote machine using ssh, type <code class="command">ssh <em class="replaceable"><code>username</code></em>@<em class="replaceable"><code>domain.name</code></em></code> at a shell prompt. If the remote machine is <code class="filename">example.com</code> and your username on that machine is john, type <code class="command">ssh john@example.com</code>.
			</div><div class="para">
				The <code class="command">mount -o remount <em class="replaceable"><code>file-system</code></em></code> command remounts the named file system. For example, to remount the <code class="filename">/home</code> file system, the command is <code class="command">mount -o remount /home</code>.
			</div><div class="para">
				To see the version of a currently installed package, use the <code class="command">rpm -q <em class="replaceable"><code>package</code></em></code> command. It will return a result as follows: <code class="command"><em class="replaceable"><code>package-version-release</code></em></code>.
			</div></blockquote></div><div class="para">
			Note the words in bold italics above — username, domain.name, file-system, package, version and release. Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.
		</div><div class="para">
			Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Publican is a <em class="firstterm">DocBook</em> publishing system.
			</div></blockquote></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id619672">1.2. Pull-quote Conventions</h3></div></div></div><div class="para">
			Terminal output and source code listings are set off visually from the surrounding text.
		</div><div class="para">
			Output sent to a terminal is set in <code class="computeroutput">mono-spaced roman</code> and presented thus:
		</div><pre class="screen">books        Desktop   documentation  drafts  mss    photos   stuff  svn
books_tests  Desktop1  downloads      images  notes  scripts  svgs</pre><div class="para">
			Source-code listings are also set in <code class="computeroutput">mono-spaced roman</code> but add syntax highlighting as follows:
		</div><pre class="programlisting">package org.<span class="perl_Function">jboss</span>.<span class="perl_Function">book</span>.<span class="perl_Function">jca</span>.<span class="perl_Function">ex1</span>;

<span class="perl_Keyword">import</span> javax.naming.InitialContext;

<span class="perl_Keyword">public</span> <span class="perl_Keyword">class</span> ExClient
{
   <span class="perl_Keyword">public</span> <span class="perl_DataType">static</span> <span class="perl_DataType">void</span> <span class="perl_Function">main</span>(String args[]) 
       <span class="perl_Keyword">throws</span> Exception
   {
      InitialContext iniCtx = <span class="perl_Keyword">new</span> InitialContext();
      Object         ref    = iniCtx.<span class="perl_Function">lookup</span>(<span class="perl_String">"EchoBean"</span>);
      EchoHome       home   = (EchoHome) ref;
      Echo           echo   = home.<span class="perl_Function">create</span>();

      System.<span class="perl_Function">out</span>.<span class="perl_Function">println</span>(<span class="perl_String">"Created Echo"</span>);

      System.<span class="perl_Function">out</span>.<span class="perl_Function">println</span>(<span class="perl_String">"Echo.echo('Hello') = "</span> + echo.<span class="perl_Function">echo</span>(<span class="perl_String">"Hello"</span>));
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id636223">1.3. Notes and Warnings</h3></div></div></div><div class="para">
			Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.
		</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				Notes are tips, shortcuts or alternative approaches to the task at hand. Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.
			</div></div></div><div class="important"><div class="admonition_header"><h2>Important</h2></div><div class="admonition"><div class="para">
				Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply. Ignoring a box labeled 'Important' will not cause data loss but may cause irritation and frustration.
			</div></div></div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
				Warnings should not be ignored. Ignoring warnings will most likely cause data loss.
			</div></div></div></div></div><div xml:lang="en-US" class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="id619704">2. We Need Feedback!</h2></div></div></div><a id="id619714" class="indexterm"></a><div class="para">
		iIf you find a typographical error in this manual, or if you have thought of a way to make this manual better, we would love to hear from you! Please submit a report in Bugzilla: <a href="http://bugs.cloud.com">http://bugs.cloud.com</a> against the component <span class="application"><strong>Doc</strong></span>
	</div><div class="para">
		If you have a suggestion for improving the documentation, try to be as specific as possible when describing it. If you have found an error, please include the section number and some of the surrounding text so we can find it easily.
	</div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-Building_your_cloud" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 1. Building Your Cloud</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Building_your_cloud-Staging_Area">1.1. Staging Area</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Building_your_cloud-Time">1.2. Taking adequate time for planning.</a></span></dt></dl></div><div class="para">
		So you are ready to start building your cloud using the CloudStack management software. Here are a few tips and tricks to help you be successful in your rollout.
	</div><div class="section" id="sect-Best_Practices_Guide-Building_your_cloud-Staging_Area"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Building_your_cloud-Staging_Area">1.1. Staging Area</h2></div></div></div><div class="para">
			Having a 
			<a id="id567129" class="indexterm"></a>
			<a id="id600496" class="indexterm"></a>
			staging system that models your production environment is strongly advised. It is critical if customizations have been applied to your CloudStack environment. A staging system allows you to make changes to your system so you can determine if there are any negative effects. Upgrades and patches all change your system's behavior. All changes should be tested before making changes to your production environment. Your staging system should be as identical to your production system as well. Small differences in hardware can be problematic when testing upgrades and patches. What affects one system may not affect the other.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Building_your_cloud-Time"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Building_your_cloud-Time">1.2. Taking adequate time for planning.</h2></div></div></div><div class="para">
			<a id="id601189" class="indexterm"></a>
			When assembling your cloud, you should allow adequate time for installation, a beta, and learning the system and software. Installs with Basic Networking can be done in a day or two. Installs with Advanced Networking usually take several days for the first attempt, with complicated installations taking longer. Allow at least 4-8 weeks for a beta to work through all of the integration issues. It can takes months to gain confidence using cloud-technologies and CloudStack.
		</div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-Clusters" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 2. Clusters</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Clusters-Limits">2.1. Recommended Limits</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Clusters-Switch_Density">2.2. Network Switch Density</a></span></dt></dl></div><div class="para">
		In cloud organization, Clusters are the smallest organizational unit. Hosts, running a common hypervisor, join together to form a cluster and receive virtual machines.
	</div><div class="section" id="sect-Best_Practices_Guide-Clusters-Limits"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Clusters-Limits">2.1. Recommended Limits</h2></div></div></div><div class="para">
			In order to maintain an efficient cloud, Citrix recommends the following logical limits when building your cloud:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					&gt;A maximum of six hosts per cluster. You can have an unlimited number of clusters per pod and the number of storage pools per cluster does not matter.
				</div></li><li class="listitem"><div class="para">
					No more than 200 virtual disks per LUN.
				</div></li><li class="listitem"><div class="para">
					Each hypervisor supports a maximum number of virtual machines per host. It is important to follow the manufacturer's recommendations.
				</div></li><li class="listitem"><div class="para">
					There are no practical limits on SRs per cluster.
				</div></li></ul></div><div class="para">
			<a id="id556619" class="indexterm"></a>
			It is also important to take into consideration host downtime. To maintain uptime whenever possible your cloud should be designed to have a host go down and have all VMs on that host migrate over to other hosts without violating the above recommendations.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Clusters-Switch_Density"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Clusters-Switch_Density">2.2. Network Switch Density</h2></div></div></div><div class="para">
			<a id="id539650" class="indexterm"></a>
			Multiple clusters can be used per pod to achieve a certain switch density. In advance networking, too many VLANs can be problematic. To reduce the number of VLANs a cluster has to handle customers should be assigned to a particular cluster and not be scattered throughout the cloud. This can be accomplished by setting the value <code class="command">use.user.concentrated.pod.allocation</code> to <code class="command">true</code>.
		</div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-Hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 3. Hypervisor Hosts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Hosts-Identical_Setup">3.1. Setting up your hosts</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Hosts-Software">3.2. Hypervisor Software</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Hosts-Capacity">3.3. Host Capacity and Overprovisioning</a></span></dt></dl></div><div class="para">
		<a id="id579901" class="indexterm"></a>
		Hosts are where the action takes place. When CloudStack receives an instruction to create a virtual machine (VM) it polls all the hosts in a particular cluster in search of one that can handle the CPU and RAM demands of the VM. The hosts run the VMs using the hypervisor software.
	</div><div class="section" id="sect-Best_Practices_Guide-Hosts-Identical_Setup"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Hosts-Identical_Setup">3.1. Setting up your hosts</h2></div></div></div><div class="para">
			<a id="id546745" class="indexterm"></a>
			It is increadibly important that the host hardware is identical with respect to the processors, number of network interface cards (NICs), and the way the network is setup on all hosts within a cluster. VMs that are setup in one configuration will expect the same hardware to be present if it is migrated to another host.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Hosts-Software"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Hosts-Software">3.2. Hypervisor Software</h2></div></div></div><div class="para">
			<a id="id597128" class="indexterm"></a>
			<a id="id613363" class="indexterm"></a>
			CloudStack currently supports the following hypervisor software versions:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					XenServer 5.6 SP2
				</div></li><li class="listitem"><div class="para">
					VMWare vSphere 4.1 with vCenter
				</div></li><li class="listitem"><div class="para">
					KVM (on RHEL/CentOS 5.6 (64-bit), RHEL6 (64-bit), Fedora 14 (64-bit), and Ubuntu 10.04 LTS (64-bit)
				</div></li><li class="listitem"><div class="para">
					Oracle VM (OVM) 2.3
				</div></li><li class="listitem"><div class="para">
					XCP 1.0 and 1.1
				</div></li></ul></div></div><div class="section" id="sect-Best_Practices_Guide-Hosts-Capacity"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Hosts-Capacity">3.3. Host Capacity and Overprovisioning</h2></div></div></div><div class="para">
			<a id="id568034" class="indexterm"></a>
			Host capacity should generally be modeled in terms of RAM for the guests. Storage and CPU may be overprovisioned. RAM may not. RAM is usually the limiting factor in capacity designs.
		</div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-KVM" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 4. KVM</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-KVM-Installation">4.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-KVM-Installation-Prerequisites">4.1.1. Prerequisites and Constraints</a></span></dt></dl></dd></dl></div><div class="para">
		<a id="id522279" class="indexterm"></a>
		<a id="id556238" class="indexterm"></a>
		The KVM hypervisor is included in <span class="trademark">Red Hat</span>® <span class="trademark">Enterprise Linux</span>® and CentOS operating systems.
	</div><div class="section" id="sect-Best_Practices_Guide-KVM-Installation"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-KVM-Installation">4.1. Installation</h2></div></div></div><div class="para">

		</div><div class="section" id="sect-Best_Practices_Guide-KVM-Installation-Prerequisites"><div class="titlepage"><div><div><h3 class="title" id="sect-Best_Practices_Guide-KVM-Installation-Prerequisites">4.1.1. Prerequisites and Constraints</h3></div></div></div><div class="para">
				All KVM Hosts must follow these guidelines:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Must be 64-bit.
					</div></li><li class="listitem"><div class="para">
						Must support HVM (Intel-VT or AMD-V enabled).
					</div></li><li class="listitem"><div class="para">
						Within a single cluster, the hosts must be homogenous. The CPUs must be of the same type, count, and feature flags.
					</div></li><li class="listitem"><div class="para">
						<a id="id558256" class="indexterm"></a>
						Within a single cluster, the hosts must be of the same kernel version. For example, if one Host is RHEL6 64 bit, they must all be RHEL6 64 bit.
					</div></li></ul></div></div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-XenServer" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 5. XenServer</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Hardware">5.1. Hardware</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Limits">5.2. VM Limits</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Reusing_Servers">5.3. Reusing Servers</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Networking">5.4. Networking</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-XenServer-Networking-Bonding">5.4.1. NIC Bonding</a></span></dt></dl></dd></dl></div><div class="para">
		<a id="id576287" class="indexterm"></a>
		<a id="id565854" class="indexterm"></a>

	</div><div class="section" id="sect-Best_Practices_Guide-XenServer-Hardware"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-XenServer-Hardware">5.1. Hardware</h2></div></div></div><div class="para">
			All hosts must be 64-bit and must support HVM (Intel-VT or AMD-V enabled). All Hosts within a Cluster must be homogeneous. That means the CPUs must be of the same type, count, and feature flags. See http://docs.vmd.citrix.com/XenServer/4.0.1/reference/ch02.html for more information on homogeneous XenServer hosts.
		</div></div><div class="section" id="sect-Best_Practices_Guide-XenServer-Limits"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-XenServer-Limits">5.2. VM Limits</h2></div></div></div><div class="para">
			<a id="id553265" class="indexterm"></a>
			All hypervisors have limits on the number of virtual machines they can handle due to memory and other constraints. In XenServer 5.x you should keep the number of virtual machines deployed on a host to 50 or less. Some improvements have been seen in version 6.0 and that number has been increased to 90.
		</div></div><div class="section" id="sect-Best_Practices_Guide-XenServer-Reusing_Servers"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-XenServer-Reusing_Servers">5.3. Reusing Servers</h2></div></div></div><div class="para">
			You must re-install Citrix XenServer if you are going to re-use a host from a previous install.
			<a id="id576156" class="indexterm"></a>

		</div></div><div class="section" id="sect-Best_Practices_Guide-XenServer-Networking"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-XenServer-Networking">5.4. Networking</h2></div></div></div><div class="para">
			<a id="id549141" class="indexterm"></a>
			Once XenServer has been installed you may need to do some additional network configuration. If you plan on using NIC bonding, the NICs on all hosts in the Cluster must be cabled exactly the same. For example, if eth0 is in the private bond on one host in a cluster, then eth0 must be in the private bond on all hosts in the cluster.
		</div><div class="para">
			The IP address assigned for the private network interface must be static. It can be set on the host itself or obtained via static DHCP.
		</div><div class="section" id="sect-Best_Practices_Guide-XenServer-Networking-Bonding"><div class="titlepage"><div><div><h3 class="title" id="sect-Best_Practices_Guide-XenServer-Networking-Bonding">5.4.1. NIC Bonding</h3></div></div></div><div class="para">
				<a id="id564494" class="indexterm"></a>
				XenServer supports Source Level Balancing (SLB) NIC bonding. You must set bonds on the first host added to a cluster. Then you must use xe commands to establish the same bonds in the second and subsequent hosts added to a cluster. Slave hosts in a cluster must be cabled exactly the same as the master. For example, if eth0 is in the private bond on the master, it must be in the private network for added slave hosts.
			</div></div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-vSphere" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 6. VMWare vSphere</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Installation">6.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">6.1.1. Prerequisites and Constraints</a></span></dt></dl></dd><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Limits">6.2. VM Limits</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Networking">6.3. Networking</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-vSphere-Networking-Increasing_Ports">6.3.1. Increasing Ports</a></span></dt></dl></dd></dl></div><div class="para">
		<a id="id557191" class="indexterm"></a>
		<a id="id522412" class="indexterm"></a>
		<a id="id553738" class="indexterm"></a>

	</div><div class="section" id="sect-Best_Practices_Guide-vSphere-Installation"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-vSphere-Installation">6.1. Installation</h2></div></div></div><div class="para">

		</div><div class="section" id="sect-Best_Practices_Guide-vSphere-Installation-Prerequisites"><div class="titlepage"><div><div><h3 class="title" id="sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">6.1.1. Prerequisites and Constraints</h3></div></div></div><div class="para">
				<a id="id589652" class="indexterm"></a>
				The following requirements must be met in order for the VMware vSphere installation to work properly:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						VMware vCenter Standard Edition 4.1 must be installed and available to manage the vSphere Hosts.
					</div></li><li class="listitem"><div class="para">
						<a id="id527396" class="indexterm"></a>
						vCenter must be configured to use the standard port 443 so that it can communicate with the CloudStack Management Server.
					</div></li><li class="listitem"><div class="para">
						You must re-install VMware ESXi if you are going to re-use a host from a previous install.
					</div></li><li class="listitem"><div class="para">
						<a id="id530862" class="indexterm"></a>
						The CloudStack requires VMware vSphere 4.1. VMware vSphere 4.0 is not supported.
					</div></li><li class="listitem"><div class="para">
						All hosts must be 64-bit and must support HVM (Intel-VT or AMD-V enabled). All Hosts within a Cluster must be homogenous. That means the CPUs must be of the same type, count, and feature flags.
					</div></li><li class="listitem"><div class="para">
						<a id="id525076" class="indexterm"></a>
						The CloudStack private network must not be configured as a separate tagged virtual network. The CloudStack private network is the same as the vCenter management network, and will inherit its configuration. See Configure vCenter Management Network on page 50.
					</div></li><li class="listitem"><div class="para">
						<a id="id636614" class="indexterm"></a>
						CloudStack requires ESXi. ESX is not supported.
					</div></li><li class="listitem"><div class="para">
						All resources used for CloudStack must be used for CloudStack only. CloudStack cannot shares instance of ESXi or storage with other management consoles. Do not share the same storage volumes that will be used by CloudStack with a different set of ESXi servers that are not managed by CloudStack.
					</div></li><li class="listitem"><div class="para">
						Put all target ESXi hypervisors in a Cluster in a separate Datacenter in vCenter.
					</div></li><li class="listitem"><div class="para">
						The cluster that will be managed by CloudStack product should not contain any VMs. Do not run the management server, vCenter or any other VMs on the cluster that is designated for CloudStack use. Create a separate cluster for use of CloudStack and make sure that they are no VMs in this cluster.
					</div></li><li class="listitem"><div class="para">
						<a id="id555714" class="indexterm"></a>
						All the required VLANs must be trunked into all the ESXi hypervisor hosts. These would include the VLANS for Management, Storage, vMotion, and guest VLANs. The guest VLAN (used in Advanced Networking; see Network Setup on page 18) is a contiguous range of VLANs that will be managed by the CloudStack Product. CloudStack does not support Distributed vSwitches in VMware.
					</div></li></ul></div></div></div><div class="section" id="sect-Best_Practices_Guide-vSphere-Limits"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-vSphere-Limits">6.2. VM Limits</h2></div></div></div><div class="para">
			<a id="id405570" class="indexterm"></a>
			All hypervisors have limits on the number of virtual machines they can handle due to memory and other constraints. VMware vSphere supports 100 to 128 virtual machines per host.
		</div></div><div class="section" id="sect-Best_Practices_Guide-vSphere-Networking"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-vSphere-Networking">6.3. Networking</h2></div></div></div><div class="para">
			<a id="id405600" class="indexterm"></a>

		</div><div class="section" id="sect-Best_Practices_Guide-vSphere-Networking-Increasing_Ports"><div class="titlepage"><div><div><h3 class="title" id="sect-Best_Practices_Guide-vSphere-Networking-Increasing_Ports">6.3.1. Increasing Ports</h3></div></div></div><div class="para">
				By default a virtual switch on ESXi hosts is created with 56 ports. We recommend setting it to 4096, the maximum number of ports allowed. To do that, click the "Properties..." link for virtual switch (note this is not the Properties link for Networking).
			</div></div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-OVM" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 7. Oracle VM (OVM)</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-OVM-Installation">7.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-OVM-Installation-Prerequisites">7.1.1. Prerequisites and Constraints</a></span></dt></dl></dd></dl></div><div class="para">
		<a id="id358854" class="indexterm"></a>

	</div><div class="section" id="sect-Best_Practices_Guide-OVM-Installation"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-OVM-Installation">7.1. Installation</h2></div></div></div><div class="para">

		</div><div class="section" id="sect-Best_Practices_Guide-OVM-Installation-Prerequisites"><div class="titlepage"><div><div><h3 class="title" id="sect-Best_Practices_Guide-OVM-Installation-Prerequisites">7.1.1. Prerequisites and Constraints</h3></div></div></div><div class="para">
				All OVM Hosts must follow these guidelines:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Must be 64-bit.
					</div></li><li class="listitem"><div class="para">
						Must support HVM (Intel-VT or AMD-V enabled).
					</div></li><li class="listitem"><div class="para">
						Within a single cluster, the hosts must be homogenous. The CPUs must be of the same type, count, and feature flags.
					</div></li><li class="listitem"><div class="para">
						<a id="id557530" class="indexterm"></a>
						Within a single cluster, the hosts must be of the same kernel version.
					</div></li></ul></div></div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-Networking" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 8. Networking</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-IP_Address_Planning">8.1. IP Address Planning</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-NIC_Bonding">8.2. NIC Bonding</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-vSphere">8.3. Networking in vSphere</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Networking-KVM_and_XenServer">8.4. Networking in KVM and XenServer</a></span></dt></dl></div><div class="para">
		<a id="id554520" class="indexterm"></a>
		Networking is as important a component to your cloud as other hardware and software. Without a good, redundant, high bandwidth network your cloud could have problems including long transfer times, virtual machine failures, and loss of data. Generally speaking, ten-gigabit networking is generally recommended for storage access when larger servers that can support relatively more VMs are used.
	</div><div class="section" id="sect-Best_Practices_Guide-Networking-IP_Address_Planning"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Networking-IP_Address_Planning">8.1. IP Address Planning</h2></div></div></div><div class="para">
			Several network subnets are required to support all the different networks that go into an operational cloud. Careful planning of IP addresses is necessary before deploying your cloud. The administrator should provide private IP addresses 
			<a id="id535494" class="indexterm"></a>
			 for the system in each pod and provision them in CloudStack.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Networking-NIC_Bonding"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Networking-NIC_Bonding">8.2. NIC Bonding</h2></div></div></div><div class="para">
			Network Interface Card, or NIC, bonding 
			<a id="id572111" class="indexterm"></a>
			 is important to maintaining connectivity throughout your cloud when network problems loom. When done properly, NIC bonding provides a redundant path for data to flow in the event that one network fails. Because bonding is generally managed through the hypervisor, the procedure for creating bonds can differ depending on the software being used. Common among all hypervisors, however, is the requirement of network interfaces to be addressed identically on all hosts.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Networking-vSphere"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Networking-vSphere">8.3. Networking in vSphere</h2></div></div></div><div class="para">
			For vSphere with advanced virtual networking, we recommend provisioning enough private IPs for your total number of customers, plus enough for the required CloudStack System VMs. Typically, about 10 additional IPs are required for the System VMs. For more information about System VMs, see Working with System Virtual Machines in the Administrator's Guide. 
			<a id="id636327" class="indexterm"></a>

		</div><div class="para">
			The Management Servers communicate with VMware vCenter servers on port 443 (HTTPS).
		</div></div><div class="section" id="sect-Best_Practices_Guide-Networking-KVM_and_XenServer"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Networking-KVM_and_XenServer">8.4. Networking in KVM and XenServer</h2></div></div></div><div class="para">
			For KVM and XenServer, the recommended number of private IPs per Pod is one per host. If you expect a Pod to grow, add enough private IPs now to accommodate the growth. 
			<a id="id522794" class="indexterm"></a>
			<a id="id613509" class="indexterm"></a>

		</div><div class="para">
			When Advanced Virtual networking is being used, the number of private IP addresses available in each Pod varies depending on which hypervisor is running on the nodes in that Pod. Citrix XenServer and KVM use link-local addresses, which in theory provide more than 65,000 private IP addresses within the address block. As the Pod grows over time, this should be more than enough for any reasonable number of hosts as well as IP addresses for guest virtual routers. VMWare ESXi, by contrast uses any administrator-specified subnetting scheme, and the typical administrator provides only 255 IPs per Pod. Since these are shared by physical machines, the guest virtual router, and other entities, it is possible to run out of private IPs when scaling up a Pod whose nodes are running ESXi.
		</div><div class="para">
			To ensure adequate headroom to scale private IP space in an ESXi Pod when Advanced Virtual networking is enabled, use one or more of the following techniques:
			<a id="id527938" class="indexterm"></a>

		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Specify a larger CIDR block for the subnet. A subnet mask with a /20 suffix will provide more than 4,000 IP addresses.
				</div></li><li class="listitem"><div class="para">
					Create multiple pods, each with its own subnet. For example, if you create 10 Pods and each pod has 255 IPs, this will provide 2,550 IP addresses.
				</div></li><li class="listitem"><div class="para">
					The secondary storage VMs and console proxy VMs connect to the Management Server on port 8250. If you are using multiple Management Servers, the load balanced IP address of the Management Servers on port 8250 must be reachable. Note that you must not expose port 8250 to the public Internet. The secondary storage VM can be located on any Host in the Zone. It uses the private network for its communication.
				</div></li><li class="listitem"><div class="para">
					The Management Server and secondary storage VMs must be able to access vCenter and all ESXi hosts in the zone. To allow the necessary access through the firewall, keep port 443 open.
				</div></li><li class="listitem"><div class="para">
					The console proxy VMs connect to all hosts in the Zone over the private network. Therefore the private network of any given Pod in the Zone must have connectivity to the private network of all other Pods in the Zone.
				</div></li><li class="listitem"><div class="para">
					The secondary storage NFS export is mounted by the secondary storage VM. Secondary storage traffic goes over the private network even if there is a separate storage network. (Primary storage traffic goes over the storage network, if available.) If you choose to place secondary storage NFS servers on the storage network, you must make sure there is a route from the private network to the storage network.
				</div></li><li class="listitem"><div class="para">
					When external firewall integration is in place, the public IP VLAN must still be trunked to the Hosts. This is required to support the Secondary Storage and Console Proxy VMs.
				</div></li><li class="listitem"><div class="para">
					The Management Servers communicate with each other to coordinate tasks amongst themselves. This communication uses TCP on ports 8250 and 9090.
				</div></li><li class="listitem"><div class="para">
					With Advanced Networking, separate subnets must be used for private and public networks.
				</div></li><li class="listitem"><div class="para">
					The public internet must not be able to access port 8096 on the Management Server.
				</div></li><li class="listitem"><div class="para">
					The Management Servers communicate with the XenServers on ports 22 (ssh) and 80 (HTTP).
				</div></li><li class="listitem"><div class="para">
					The Management Servers communicate with the KVM servers on port 22 (ssh).
				</div></li></ul></div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-Database" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 9. MySQL Database</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Database-Security">9.1. Security</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Database-Replication">9.2. Replication</a></span></dt></dl></div><div class="para">
		<a id="id558251" class="indexterm"></a>
		<a id="id523775" class="indexterm"></a>
		The <span class="application"><strong>MySQL</strong></span> database houses all information about your cloud. It is imperative to protect the database against corruption, loss, unavailablilty.
	</div><div class="section" id="sect-Best_Practices_Guide-Database-Security"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Database-Security">9.1. Security</h2></div></div></div><div class="para">
			<a id="id596380" class="indexterm"></a>
			On RHEL and CentOS, MySQL does not set a root password by default. It is very strongly recommended that you set a root password as a security precaution. Run the following commands, and substitute your own desired root password for passwd. 
<pre class="screen"># service mysqld start

# mysql -u root

mysql&gt; SET PASSWORD = PASSWORD('passwd');</pre>

		</div></div><div class="section" id="sect-Best_Practices_Guide-Database-Replication"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Database-Replication">9.2. Replication</h2></div></div></div><div class="para">
			<a id="id634406" class="indexterm"></a>
			CloudStack supports database replication from one MySQL node to another. Creating a replica is not a backup solution. You should develop a backup procedure for the MySQL data that is distinct from replication.
		</div><div class="para">
			Edit my.cnf on the master and add the following in the [mysqld] section below datadir.
		</div><pre class="screen">log_bin=mysql-bin
server_id=1</pre><div class="para">
			The server_id must be unique with respect to other servers. The recommended way to achieve this is to give the master an ID of 1 and each slave a sequential number greater than 1, so that the servers are numbered 1, 2, 3, etc.
		</div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-Primary_Storage" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 10. Primary Storage</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Primary_Storage-Per_Cluster">10.1. Primary Storage per Cluster</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Primary_Storage-Utilizing_RAID">10.2. Utilizing RAID</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Primary_Storage-Limiting_NFS_Export">10.3. Limiting NFS Export</a></span></dt></dl></div><div class="para">
		Primary Storage
		<a id="id558252" class="indexterm"></a>
		<a id="id555650" class="indexterm"></a>
		 is the storage used by hypervisors to store virtual machines. Depending on the hypervisor software, the primary storage could be an NFS share, fiber channel, or other type.
	</div><div class="section" id="sect-Best_Practices_Guide-Primary_Storage-Per_Cluster"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Primary_Storage-Per_Cluster">10.1. Primary Storage per Cluster</h2></div></div></div><div class="para">
			Primary storage mountpoints or LUNs should not exceed 6 TB in size. It is better to have multiple smaller primary storage elements per Cluster than one large one.
		</div><div class="para">
			When exporting shares on primary storage, avoid data loss by restricting the range of IP addresses that can access the storage.
		</div><div class="para">
			Monitor host disk space. Many host failures occur because the host's root disk fills up from logs that were not rotated adequately.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Primary_Storage-Utilizing_RAID"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Primary_Storage-Utilizing_RAID">10.2. Utilizing RAID</h2></div></div></div><div class="para">
			It is important that the storage server contain many large disks and use a hardware RAID
			<a id="id571742" class="indexterm"></a>
			 controller. Hardware RAID is faster than software RAID and has the added bonus of supporting hot plug functionality independent of the operating system so you can replace faulty disks without impacting the running operating system.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Primary_Storage-Limiting_NFS_Export"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Primary_Storage-Limiting_NFS_Export">10.3. Limiting NFS Export</h2></div></div></div><div class="para">
			It is highly recommended that you limit the NFS export to a particular subnet by specifying a subnet mask (e.g.,"192.168.1.0/24"). By allowing access from only within the expected cluster, you avoid having non-pool member mount the storage. The limit you place must include the private network(s) and the storage network(s). If the two are the same network then one CIDR is sufficient. If you have a separate storage network you must provide separate CIDR's for both or one CIDR that is broad enough to span both.
		</div><div class="para">
			<code class="command"># echo "/export CIDR(rw,async,no_root_squash)" &gt;&gt; /etc/exports</code>
		</div><div class="para">
			The following is an example with separate CIDRs:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					<code class="command">/export 192.168.1.0/24(rw,async,no_root_squash) 10.50.1.0/24(rw,async,no_root_squash)</code>
				</div></li></ul></div><div class="para">
			Removing the async flag. The async flag improves performance by allowing the NFS server to respond before writes are committed to the disk. Remove the async flag in your mission critical production deployment.
		</div><div class="para">
			The volumes used for Primary and Secondary storage should be accessible from Management Server and the hypervisors. These volumes should allow root users to read/write data. These volumes must be for the exclusive use of CloudStack and should not contain any data.
		</div></div></div><div xml:lang="en-US" class="chapter" id="chap-Best_Practices_Guide-Templates" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 11. Templates</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sect-Best_Practices_Guide-Templates-Large_Templates">11.1. Large Templates</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Templates-XenServer">11.2. Templates in XenServer</a></span></dt><dt><span class="section"><a href="#sect-Best_Practices_Guide-Templates-vSphere">11.3. Templates in vSphere</a></span></dt></dl></div><div class="para">
		Templates are virtual machines that have been customized for a specific purpose to allow easy implementation of new virtual machines of the same type. An example would be a <span class="trademark">RHEL</span>® 6.2 server with <span class="trademark">Apache</span>® installed and hardened. By creating a template from this virtual machine you can then make new installations of this virtual machine quickly.
	</div><div class="section" id="sect-Best_Practices_Guide-Templates-Large_Templates"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Templates-Large_Templates">11.1. Large Templates</h2></div></div></div><div class="para">
			<a id="id639098" class="indexterm"></a>
			If you plan to use large templates (100GB or larger), be sure you have a 10-gigabit network to support the large templates. A slower network can lead to timeouts and other errors when large templates are used.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Templates-XenServer"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Templates-XenServer">11.2. Templates in XenServer</h2></div></div></div><div class="para">
			When running XenServer
			<a id="id638565" class="indexterm"></a>
			, install PV drivers and Xen tools on each template you create as this will enable live migration and clean guest shutdown.
		</div></div><div class="section" id="sect-Best_Practices_Guide-Templates-vSphere"><div class="titlepage"><div><div><h2 class="title" id="sect-Best_Practices_Guide-Templates-vSphere">11.3. Templates in vSphere</h2></div></div></div><div class="para">
			When running vSphere
			<a id="id613399" class="indexterm"></a>
			, install VMware Tools on each template that you create as this will enable console view to work properly.
		</div></div></div><div xml:lang="en-US" class="appendix" id="appe-Best_Practices_Guide-Revision_History" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Revision History</h1></div></div></div><div class="para">
		<div class="revhistory"><table border="0" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><strong>Revision History</strong></th></tr><tr><td align="left">Revision 2.2.13-1</td><td align="left">Sun Dec 18 2011</td><td align="left"><span class="author"><span class="firstname">Eric</span> <span class="surname">Christensen</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Added additional information.</td></tr></table>

				</td></tr><tr><td align="left">Revision 2.2.13-0</td><td align="left">Tue Nov 29 2011</td><td align="left"><span class="author"><span class="firstname">Eric</span> <span class="surname">Christensen</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Initial creation of book by publican.</td></tr><tr><td>Updated default text to include CloudStack-specific text.</td></tr><tr><td>Added initial information.</td></tr></table>

				</td></tr></table></div>

	</div></div><div class="index" id="id367157"><div class="titlepage"><div><div><h2 class="title">Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>D</h3><dl><dt>database</dt><dd><dl><dt>MySQL, <a class="indexterm" href="#chap-Best_Practices_Guide-Database">MySQL Database</a></dt><dt>replication, <a class="indexterm" href="#sect-Best_Practices_Guide-Database-Replication">Replication</a></dt><dt>security, <a class="indexterm" href="#sect-Best_Practices_Guide-Database-Security">Security</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>feedback1</dt><dd><dl><dt>contact information for this brand, <a class="indexterm" href="#id619704">We Need Feedback!</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>H</h3><dl><dt>hosts, <a class="indexterm" href="#chap-Best_Practices_Guide-Hosts">Hypervisor Hosts</a></dt><dd><dl><dt>hypervisors, <a class="indexterm" href="#sect-Best_Practices_Guide-Hosts-Software">Hypervisor Software</a></dt><dt>overprovisioning, <a class="indexterm" href="#sect-Best_Practices_Guide-Hosts-Capacity">Host Capacity and Overprovisioning</a></dt><dt>setup, <a class="indexterm" href="#sect-Best_Practices_Guide-Hosts-Identical_Setup">Setting up your hosts</a></dt></dl></dd><dt>hypervisors</dt><dd><dl><dt>KVM, <a class="indexterm" href="#chap-Best_Practices_Guide-KVM">KVM</a></dt><dd><dl><dt>kernel versions, <a class="indexterm" href="#sect-Best_Practices_Guide-KVM-Installation-Prerequisites">Prerequisites and Constraints</a></dt><dt>Networking, <a class="indexterm" href="#sect-Best_Practices_Guide-Networking-KVM_and_XenServer">Networking in KVM and XenServer</a></dt></dl></dd><dt>Oracle VM (OVM), <a class="indexterm" href="#chap-Best_Practices_Guide-OVM">Oracle VM (OVM)</a></dt><dd><dl><dt>kernel versions, <a class="indexterm" href="#sect-Best_Practices_Guide-OVM-Installation-Prerequisites">Prerequisites and Constraints</a></dt></dl></dd><dt>supported versions, <a class="indexterm" href="#sect-Best_Practices_Guide-Hosts-Software">Hypervisor Software</a></dt><dt>vSphere, <a class="indexterm" href="#chap-Best_Practices_Guide-vSphere">VMWare vSphere</a></dt><dd><dl><dt>Advanced Virtual Networking, <a class="indexterm" href="#sect-Best_Practices_Guide-Networking-vSphere">Networking in vSphere</a></dt><dt>ESX, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">Prerequisites and Constraints</a></dt><dt>installation prerequisites, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">Prerequisites and Constraints</a></dt><dt>management ports, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">Prerequisites and Constraints</a></dt><dt>networking, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Networking">Networking</a></dt><dt>supported versions, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">Prerequisites and Constraints</a></dt><dt>Templates, <a class="indexterm" href="#sect-Best_Practices_Guide-Templates-vSphere">Templates in vSphere</a></dt><dt>virtual networking, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">Prerequisites and Constraints</a></dt><dt>VLANs, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Installation-Prerequisites">Prerequisites and Constraints</a></dt><dt>VM limits, <a class="indexterm" href="#sect-Best_Practices_Guide-vSphere-Limits">VM Limits</a></dt></dl></dd><dt>XenServer, <a class="indexterm" href="#chap-Best_Practices_Guide-XenServer">XenServer</a></dt><dd><dl><dt>network bonding, <a class="indexterm" href="#sect-Best_Practices_Guide-XenServer-Networking-Bonding">NIC Bonding</a></dt><dt>networking, <a class="indexterm" href="#sect-Best_Practices_Guide-XenServer-Networking">Networking</a></dt><dt>Networking, <a class="indexterm" href="#sect-Best_Practices_Guide-Networking-KVM_and_XenServer">Networking in KVM and XenServer</a></dt><dt>Reusing Servers, <a class="indexterm" href="#sect-Best_Practices_Guide-XenServer-Reusing_Servers">Reusing Servers</a></dt><dt>Templates, <a class="indexterm" href="#sect-Best_Practices_Guide-Templates-XenServer">Templates in XenServer</a></dt><dt>VM limits, <a class="indexterm" href="#sect-Best_Practices_Guide-XenServer-Limits">VM Limits</a></dt></dl></dd></dl></dd></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>IP Addresses</dt><dd><dl><dt>Private, <a class="indexterm" href="#sect-Best_Practices_Guide-Networking-KVM_and_XenServer">Networking in KVM and XenServer</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>K</h3><dl><dt>KVM (see hypervisors)</dt></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>maintenance</dt><dd><dl><dt>host downtime, <a class="indexterm" href="#sect-Best_Practices_Guide-Clusters-Limits">Recommended Limits</a></dt></dl></dd><dt>MySQL (see database)</dt></dl></div><div class="indexdiv"><h3>N</h3><dl><dt>networking, <a class="indexterm" href="#chap-Best_Practices_Guide-Networking">Networking</a></dt><dd><dl><dt>bonding, <a class="indexterm" href="#sect-Best_Practices_Guide-Networking-NIC_Bonding">NIC Bonding</a></dt><dt>IP Addresses</dt><dd><dl><dt>Private, <a class="indexterm" href="#sect-Best_Practices_Guide-Networking-IP_Address_Planning">IP Address Planning</a></dt></dl></dd><dt>switch density, <a class="indexterm" href="#sect-Best_Practices_Guide-Clusters-Switch_Density">Network Switch Density</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>planning, <a class="indexterm" href="#sect-Best_Practices_Guide-Building_your_cloud-Time">Taking adequate time for planning.</a></dt><dt>primary storage (see storage)</dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>staging system, <a class="indexterm" href="#sect-Best_Practices_Guide-Building_your_cloud-Staging_Area">Staging Area</a></dt><dt>storage</dt><dd><dl><dt>primary, <a class="indexterm" href="#chap-Best_Practices_Guide-Primary_Storage">Primary Storage</a></dt><dt>RAID, <a class="indexterm" href="#sect-Best_Practices_Guide-Primary_Storage-Utilizing_RAID">Utilizing RAID</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>Templates</dt><dd><dl><dt>large, <a class="indexterm" href="#sect-Best_Practices_Guide-Templates-Large_Templates">Large Templates</a></dt></dl></dd><dt>testing updates, <a class="indexterm" href="#sect-Best_Practices_Guide-Building_your_cloud-Staging_Area">Staging Area</a></dt></dl></div><div class="indexdiv"><h3>V</h3><dl><dt>VMWare (see hypervisors)</dt><dt>vSphere (see hypervisors)</dt></dl></div><div class="indexdiv"><h3>X</h3><dl><dt>XenServer (see hypervisors)</dt></dl></div></div></div></div></body></html>
